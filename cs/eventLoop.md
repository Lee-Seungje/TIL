# Event Loop

## **이벤트 루프 JSConf**

자바스크립트 : 싱글 스레드 논 블록킹 비동기 동적 언어

V8 : javascript run time engine

자바스크립트 런타임을 단순화하면 메모리 할당이 일어나는 힙과 스택이 보인다.

브라우저는 DOM, AJAX, timeout, event loop, callback queue를 가지고있다.

하지만 이것들이 어떤식으로 연결되어 움직이는지는 알기 쉽지 않다.

자바스크립트는 싱글 스레드 프로그래밍 언어이다.

콜 스택은 데이터 스트럭처로 실행되는 순서를 기억한다. 함수를 실행하려면 스택에 해당하는 함수를 집어넣고 함수에서 리턴이 일어나면 가장 위 함수를 꺼낸다.

이 스택의 용량이 초과되면 아래와 같은 오류가 나타난다.

<img width="1268" alt="RangeError Maximum call stack size exceeded" src="https://github.com/Stack-Knowledge/Stack-Knowledge-front/assets/106712562/c7bd1dce-8dbe-4a98-9287-3eb8b19fa854">

Blocking

블로킹은 느리게 동작하는 코드이다. 느린 동작이 스택에 남아있는 것을 보통 블로킹이라고 한다.

프로그래밍 언어에서 싱글스레드는 여러 개의 스레드를 사용하지 않는다는 의미이다.

동기적으로 실행되는 네트워크 요청이 콜 스택을 블로킹하면 브라우저는 다른 일들을 할 수 없다. 렌더링이나 다른 코드를 실행할 수 없다.

브라우저는 단순 런타임 이상을 의미한다. 자바스크립트 런타임은 한 번에 하나의 일만 할 수 있다. 하지만 브라우저가 제공하는 API에서는 자바스크립트에서 호출할 수 있는 스레드를 지원한다.

setTimeout은 브라우저에서 제공하는 API이다. 자바스크립트가 실행되는 런타임 환경에 존재하는 별도의 API이다. setTimeout이 실행되면 스택에 쌓였다가 web API에서 테스크 큐에 콜백을 넘긴다.

Event Loop

이벤트 루프는 콜 스택과 테스크 큐를 주시하는 작은 파트를 담당한다. 스택이 비어있고 테스크 큐에 콜백이 존재한다면 이벤트 루프는 콜백을 스택에 넣어준다. setTimeout의 콜백도 결국 이벤트 루프에 의해 콜 스택으로 이동한다.

이 과정이 비동기 함수가 호출되는 방식이다.

콜백은 무엇인가.

1. 콜백은 다른 함수가 부르는 함수이다.
2. 큐에 쌓일 비동기식 콜백.

브라우저는 자바스크립트의 동작에 제약을 받는다. 렌더도 하나의 콜백처럼 행동하기 때문에 스택에 코드가 있으면 렌더링을 하지 못한다. 느린 동기식 코드를 진행하면 렌더는 막히게된다. 비동기로 큐에 콜백이 쌓인다면 렌더가 끼어들 수 있다. 따라서 상대적으로 빠르게 처리된다.

이미지 처리나 애니메이션같은 느린 작업이 잦아지면 큐 관리에 지장이 생길 수 있다.

예시로 스크롤 이벤트가 생길 때마다 어떠한 동작을 수행한다면 큐에 엄청나게 많은 콜백이 쌓이고 처리하며 성능에 문제가 생길 것이다. 이를 해결하기 위해 throttle이나 debounce같은 기법을 사용할 수 있다.
